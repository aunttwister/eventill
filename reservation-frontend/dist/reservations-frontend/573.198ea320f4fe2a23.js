"use strict";(self.webpackChunkReservations_Frontend=self.webpackChunkReservations_Frontend||[]).push([[573],{3573:(_e,g,r)=>{r.r(g),r.d(g,{EventOccurrenceOverviewComponent:()=>v});var l=r(7340),u=r(6895),p=r(4931),h=r(6308),a=r(7155),f=r(7392),x=r(6709),C=r(4859);class T{}class E{constructor(n,t,o,c,s,m,_,me,de,ve){this.id=n,this.name=t,this.email=o,this.phoneNumber=c,this.ticketCount=s,this.eventOccurrenceId=m,this.paymentCompleted=_,this.isDeleted=me,this.tickets=de,this.userId=ve}}class b{constructor(n,t,o,c,s,m,_){this.id=n,this.startTime=t,this.eventId=o,this.isActive=c,this.isDeleted=s,this.tickets=m,this.reservations=_}}class D{}var e=r(4650),k=r(26),y=r(1481),S=r(5961),O=r(529);const w=r(2340).N.url;class d{constructor(n){this.http=n,this.options={headers:(new O.WM).set("Content-Type","application/json")}}getEventOccurrence(n){return this.http.get(w+"EventOccurrence/"+n)}postMultipleEventOccurrences(n){let t=JSON.stringify(n);return this.http.post(w+"EventOccurrence/edit/multiple/",t,this.options)}}d.\u0275fac=function(n){return new(n||d)(e.LFG(O.eN))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"});var M=r(2013);const N=["outerSort"],Y=["innerSort"],R=["innerTables"];function A(i,n){if(1&i&&(e.TgZ(0,"th",14),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.header," ")}}function I(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-checkbox",19),e.NdJ("change",function(){e.CHM(t);const c=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.onCheckboxChangeEventOccurrence(c))}),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("disabled",0!=t.reservations.length)("checked",t.isActive)}}function J(i,n){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t[o.value],"MM.dd.YYYY HH:mm")," ")}}function Q(i,n){if(1&i&&e._uU(0),2&i){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.hij("",t[o.value]," ")}}function $(i,n){if(1&i&&(e.TgZ(0,"td",15),e.YNc(1,I,2,2,"div",16),e.YNc(2,J,3,4,"div",17),e.YNc(3,Q,1,1,"ng-template",null,18,e.W1O),e.qZA()),2&i){const t=e.MAs(4),o=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf","activate"===o.value),e.xp6(1),e.Q6J("ngIf","startTime"===o.value)("ngIfElse",t)}}function z(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",22)(1,"button",23),e.NdJ("click",function(){e.CHM(t);const c=e.oxw(3);return e.KtG(c.onSaveOuterTable())}),e.TgZ(2,"span"),e._uU(3,"Sa\u010duvaj"),e.qZA()()()}}function P(i,n){if(1&i&&(e.TgZ(0,"td",20),e.YNc(1,z,4,0,"div",21),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf",t.value===o.columnsToDisplayComplex[o.columnsToDisplayComplex.length-1].value)}}function U(i,n){1&i&&(e.ynx(0,11),e.YNc(1,A,2,1,"th",12),e.YNc(2,$,5,3,"td",5),e.YNc(3,P,2,1,"td",13),e.BQk()),2&i&&e.s9C("matColumnDef",n.$implicit.value)}function F(i,n){if(1&i&&(e.TgZ(0,"th",14),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.header," ")}}function H(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-checkbox",31),e.NdJ("change",function(){e.CHM(t);const c=e.oxw().$implicit,s=e.oxw(5);return e.KtG(s.onCheckboxChangeReservation(c))}),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("checked",t.paymentCompleted)}}function G(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"button",32),e.NdJ("click",function(){e.CHM(t);const c=e.oxw().$implicit,s=e.oxw(5);return e.KtG(s.onDelete(c))}),e._UZ(2,"mat-icon",33),e.qZA()()}}function j(i,n){if(1&i&&e._uU(0),2&i){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.hij("",t[o.value]," ")}}function B(i,n){if(1&i&&(e.TgZ(0,"td",15),e.YNc(1,H,2,1,"div",17),e.YNc(2,G,3,0,"div",16),e.YNc(3,j,1,1,"ng-template",null,18,e.W1O),e.qZA()),2&i){const t=e.MAs(4),o=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf","paymentCompleted"===o.value)("ngIfElse",t),e.xp6(1),e.Q6J("ngIf","delete"===o.value)}}function K(i,n){1&i&&(e.TgZ(0,"div")(1,"button",34)(2,"span"),e._uU(3,"Excel Export"),e.qZA(),e._UZ(4,"mat-icon",35),e.qZA()())}function W(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"button",36),e.NdJ("click",function(){e.CHM(t);const c=e.oxw(6);return e.KtG(c.onSaveInnerTable())}),e._uU(2,"Save"),e.qZA()()}}function q(i,n){if(1&i&&(e.TgZ(0,"td",20),e.YNc(1,K,5,0,"div",16),e.YNc(2,W,3,0,"div",16),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw(4);e.xp6(1),e.Q6J("ngIf",t.value==o.innerDisplayedColumnsComplex[o.innerDisplayedColumnsComplex.length-2].value),e.xp6(1),e.Q6J("ngIf",t.value==o.innerDisplayedColumnsComplex[o.innerDisplayedColumnsComplex.length-1].value)}}function L(i,n){1&i&&(e.ynx(0,11),e.YNc(1,F,2,1,"th",12),e.YNc(2,B,5,3,"td",5),e.YNc(3,q,3,2,"td",13),e.BQk()),2&i&&e.s9C("matColumnDef",n.$implicit.value)}function X(i,n){1&i&&e._UZ(0,"tr",37)}function V(i,n){1&i&&e._UZ(0,"tr",38)}function ee(i,n){1&i&&e._UZ(0,"tr",39)}function te(i,n){if(1&i&&(e.TgZ(0,"div",27)(1,"table",28,29),e.YNc(4,L,4,1,"ng-container",3),e.YNc(5,X,1,0,"tr",6),e.YNc(6,V,1,0,"tr",30),e.YNc(7,ee,1,0,"tr",9),e.qZA()()),2&i){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.Q6J("dataSource",t.reservations),e.xp6(3),e.Q6J("ngForOf",o.innerDisplayedColumnsComplex),e.xp6(1),e.Q6J("matHeaderRowDef",o.innerDisplayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.innerDisplayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",o.innerDisplayedColumns)("matFooterRowDefSticky",!0)}}function ne(i,n){if(1&i&&(e.TgZ(0,"div",25),e.YNc(1,te,8,6,"div",26),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("@detailExpand",t==o.expandedElement?"expanded":"collapsed"),e.xp6(1),e.Q6J("ngIf",o.expandedElement)}}function ie(i,n){if(1&i&&(e.TgZ(0,"td",15),e.YNc(1,ne,2,2,"div",24),e.qZA()),2&i){const t=n.$implicit,o=e.oxw();e.uIk("colspan",o.columnsToDisplay.length),e.xp6(1),e.Q6J("ngIf",t.reservations.length)}}function oe(i,n){1&i&&e._UZ(0,"tr",37)}function ce(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"tr",40),e.NdJ("click",function(){const s=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.toggleRow(s))}),e.qZA()}if(2&i){const t=n.$implicit,o=e.oxw();e.ekj("example-element-row",t.reservations.length)("example-expanded-row",o.expandedElement===t)}}function re(i,n){1&i&&e._UZ(0,"tr",41)}function ae(i,n){1&i&&e._UZ(0,"tr",39)}const se=function(){return["expandedDetail"]},le=function(){return[5,10,25,100]};class v{constructor(n,t,o,c,s,m,_){this.eventService=n,this.cd=t,this.matIconRegistry=o,this.domSanitizer=c,this.reservationService=s,this.eventOccurrenceService=m,this.notificationService=_,this.isLoaded=!1,this.eventOccurrencesView=new Array,this.eventOccurrencesData=[],this.columnsToDisplay=["startTime","totalTicketCount","availableTicketCount","reservedTicketCount","soldTicketCount","activate"],this.columnsToDisplayComplex=[{header:"Po\u010detak",value:"startTime"},{header:"Ukupno karata",value:"totalTicketCount"},{header:"Dostupno karata",value:"availableTicketCount"},{header:"Rezervisano karata",value:"reservedTicketCount"},{header:"Prodato karata",value:"soldTicketCount"},{header:"Aktivno",value:"activate"}],this.innerDisplayedColumns=["name","email","phoneNumber","ticketCount","paymentCompleted","delete"],this.innerDisplayedColumnsComplex=[{header:"Ime i prezime",value:"name"},{header:"Email",value:"email"},{header:"Broj telefona",value:"phoneNumber"},{header:"Broj karata",value:"ticketCount"},{header:"Pla\u0107anje izvr\u0161eno",value:"paymentCompleted"},{header:"Obri\u0161i",value:"delete"}],this.eventOccurrenceChanges=new Array,this.reservationsChanges=new Array,o.addSvgIcon("excel_icon",this.domSanitizer.bypassSecurityTrustResourceUrl("../../../../assets/icons8-microsoft-excel.svg")),o.addSvgIcon("delete_icon",this.domSanitizer.bypassSecurityTrustResourceUrl("../../../../assets/icons8-close.svg"))}ngOnChanges(n){}ngOnInit(){this.getEventOccurrences()}loadTableData(){this.eventOccurrencesView.forEach(n=>{this.eventOccurrencesData=n.reservations&&Array.isArray(n.reservations)?[...this.eventOccurrencesData,{...n,reservations:n.reservations}]:[...this.eventOccurrencesData,n]}),this.dataSource=new a.by(this.eventOccurrencesData),this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator}toggleRow(n){n.reservations&&n.reservations.length&&(this.expandedElement=n),this.cd.detectChanges(),this.innerTables.forEach((t,o)=>t.dataSource.sort=this.innerSort.toArray()[o])}getEventOccurrences(){return this.eventService.getEvent(1).subscribe(n=>{this.eventOccurrencesView=n.eventOccurrences,this.loadTableData(),this.isLoaded=!0})}onSaveOuterTable(){let n=new D;n.eventOccurrences=new Array,this.eventOccurrenceChanges.forEach(t=>{n.eventOccurrences.push(new b(t.id,t.startTime,t.eventId,t.isActive,t.isDeleted,t.tickets,0!=t.reservations.length?t.reservations:this.reservationsChanges.filter(o=>o.eventOccurrenceId===t.id)))}),this.eventOccurrenceService.postMultipleEventOccurrences(n).subscribe(t=>{this.notificationService.showSuccess("Event Occurrences successfully updated! Refresh the page to see the results.","Success!")},t=>{this.notificationService.showError(t.error.error,"StatusCode: "+t.status)})}onSaveInnerTable(){let n=new T;n.reservations=new Array,this.reservationsChanges.forEach(t=>{n.reservations.push(new E(t.id,t.name,t.email,t.phoneNumber,t.tickets.length,t.eventOccurrenceId,t.paymentCompleted,t.isDeleted,t.tickets,t.userId))}),this.reservationService.postEventReservations(n).subscribe(t=>{this.notificationService.showSuccess("Reservations successfully updated! Refresh the page to see the results.","Success!")},t=>{this.notificationService.showError(t.error.error,"StatusCode: "+t.status)})}onDelete(n){n.isDeleted=!0,this.reservationsChanges.push(n);let t=this.separateEventOccurrence(n.eventOccurrenceId);t.reservations=t.reservations.filter(o=>o.id!=n.id)}separateEventOccurrence(n){return this.dataSource.data.filter(t=>t.id==n)[0]}onCheckboxChangeEventOccurrence(n){n.isActive=!n.isActive;let o=this.eventOccurrenceChanges.findIndex(c=>c.id===n.id);-1===o?this.eventOccurrenceChanges.push(n):this.eventOccurrenceChanges[o]=n}onCheckboxChangeReservation(n){n.paymentCompleted=!n.paymentCompleted;let o=this.reservationsChanges.findIndex(c=>c.id===n.id);-1===o?this.reservationsChanges.push(n):this.reservationsChanges[o]=n}}v.\u0275fac=function(n){return new(n||v)(e.Y36(k.P),e.Y36(e.sBO),e.Y36(f.jv),e.Y36(y.H7),e.Y36(S.D),e.Y36(d),e.Y36(M.g))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-event-occurrence-overview"]],viewQuery:function(n,t){if(1&n&&(e.Gf(p.NW,5),e.Gf(N,7),e.Gf(Y,5),e.Gf(R,5)),2&n){let o;e.iGM(o=e.CRH())&&(t.paginator=o.first),e.iGM(o=e.CRH())&&(t.sort=o.first),e.iGM(o=e.CRH())&&(t.innerSort=o),e.iGM(o=e.CRH())&&(t.innerTables=o)}},standalone:!0,features:[e.TTD,e.jDz],decls:11,vars:11,consts:[[1,"mat-elevation-z8"],["mat-table","","multiTemplateDataRows","","matSort","","matSortActive","Datum","matSortDirection","asc",1,"main-table",3,"dataSource"],["outerSort","matSort"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","expandedDetail"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"example-element-row","example-expanded-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","example-detail-row",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],["aria-label","Select page of eventOccurrencesView",3,"pageSize","pageSizeOptions"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],["default_content",""],[2,"padding-right","37px",3,"disabled","checked","change"],["mat-footer-cell",""],["style","margin-right: 32px;",4,"ngIf"],[2,"margin-right","32px"],["mat-raised-button","",3,"click"],["class","example-element-detail",4,"ngIf"],[1,"example-element-detail"],["class","inner-table mat-elevation-z8",4,"ngIf"],[1,"inner-table","mat-elevation-z8"],["mat-table","","matSort","",3,"dataSource"],["innerTables","","innerSort","matSort"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"checked","change"],["mat-flat-button","",2,"margin-right","42px",3,"click"],["svgIcon","delete_icon",2,"padding-left","0"],["mat-raised-button",""],["svgIcon","excel_icon"],["mat-raised-button","",2,"margin-right","40px",3,"click"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],["mat-row","",3,"click"],["mat-row","",1,"example-detail-row"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"table",1,2),e.YNc(3,U,4,1,"ng-container",3),e.ynx(4,4),e.YNc(5,ie,2,2,"td",5),e.BQk(),e.YNc(6,oe,1,0,"tr",6),e.YNc(7,ce,1,4,"tr",7),e.YNc(8,re,1,0,"tr",8),e.YNc(9,ae,1,0,"tr",9),e.qZA(),e._UZ(10,"mat-paginator",10),e.qZA()),2&n&&(e.xp6(1),e.Q6J("dataSource",t.dataSource),e.xp6(2),e.Q6J("ngForOf",t.columnsToDisplayComplex),e.xp6(3),e.Q6J("matHeaderRowDef",t.columnsToDisplay),e.xp6(1),e.Q6J("matRowDefColumns",t.columnsToDisplay),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(9,se)),e.xp6(1),e.Q6J("matFooterRowDef",t.columnsToDisplay)("matFooterRowDefSticky",!0),e.xp6(1),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(10,le)))},dependencies:[u.ez,u.sg,u.O5,u.uU,a.p0,a.BZ,a.fO,a.as,a.w1,a.Dz,a.nj,a.mD,a.Ke,a.ge,a.ev,a.yh,a.XQ,a.Gk,a.Q2,p.TU,p.NW,h.JX,h.YE,h.nU,C.ot,C.lW,f.Ps,f.Hw,x.p9,x.oG],styles:[".mat-button-wrapper, .mat-table[_ngcontent-%COMP%], .mat-paginator[_ngcontent-%COMP%], .mat-form-field[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;font-size:medium;font-weight:500;color:#fff}  .mat-flat-button{background-color:#a6a68ee6}  .mat-raised-button{color:#fff;background-color:#887}  .mat-table, .mat-option[_ngcontent-%COMP%]{background-color:#a6a68ee6}  .mat-option-text{font-family:Montserrat,sans-serif;font-size:medium;font-weight:500;color:#fff}  .mat-select-panel{font-family:Montserrat,sans-serif;font-size:medium;font-weight:500;color:#fff;background-color:#a6a68ee6}  .mat-select-value{font-family:Montserrat,sans-serif;font-size:medium;font-weight:500;color:#fff}  .mat-focused{color:#000!important}  .mat-option{background-color:#a6a68ee6}  .mat-paginator{background-color:#a6a68e}  .mat-header-cell, .mat-cell[_ngcontent-%COMP%]{font-size:large;font-weight:500;color:#fff}  .mat-sort-header-container{display:flex;justify-content:center}  .mat-header-cell:first-of-type{padding:0!important}  td{padding:0!important}  .mat-checkbox-checked .mat-checkbox-background, .mat-checkbox-indeterminate[_ngcontent-%COMP%]   .mat-checkbox-background[_ngcontent-%COMP%]{background-color:#666658!important}  .mat-checkbox:not(.mat-checkbox-disabled) .mat-checkbox-ripple .mat-ripple-element{background-color:#666658!important}  mat-icon{padding-left:5px}.main-table[_ngcontent-%COMP%]{width:70vw}th[_ngcontent-%COMP%]{height:3vh}tr.example-detail-row[_ngcontent-%COMP%]{height:0}tr.example-element-row[_ngcontent-%COMP%]:not(.example-expanded-row):hover{background:rgb(151,151,131)}tr.example-element-row[_ngcontent-%COMP%]:not(.example-expanded-row):active{background:rgb(136,136,117)}.example-element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.example-element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex;padding-left:24px!important;width:calc(100% - 24px)}.example-element-detail[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.inner-table[_ngcontent-%COMP%]{width:100%;box-shadow:none}"],data:{animation:[(0,l.X$)("detailExpand",[(0,l.SB)("collapsed",(0,l.oB)({height:"0px",minHeight:"0"})),(0,l.SB)("expanded",(0,l.oB)({height:"*"})),(0,l.eR)("expanded <=> collapsed",(0,l.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]},changeDetection:0})}}]);